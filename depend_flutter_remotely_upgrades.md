# iOSé¡¹ç›®è¿œç¨‹ä¾èµ–Flutter Moduleäº§ç‰© + Git Submodule + Shellè„šæœ¬ ï¼ˆå‡çº§ç‰ˆ ï¼‰


å›é¡¾ä¸€ä¸‹ä¹‹å‰æ•´ç†çš„æ–¹æ¡ˆï¼Œ[è¿œç¨‹ä¾èµ–Flutter Moduleç»„ä»¶åº“ç¼–è¯‘äº§ç‰©ï¼ˆç®€å•ç‰ˆï¼‰]ä¸­å°†`Flutter.xcframework`ã€å…¶å®ƒ`.xcframework`ã€podspecéƒ½æ”¾åœ¨ä¸€ä¸ªGitä»“åº“ä¸Šï¼ŒiOSç«¯è¿œç¨‹ä¾èµ–è¿™ä¸ªGitï¼Œä½†æ˜¯ç”±äº`Flutter.xcframework`æ–‡ä»¶å¤ªå¤§ï¼Œå¯¼è‡´æäº¤åˆ°ä»“åº“ã€ä»ä»“åº“æ‹‰å–è€—æ—¶è¿‡ä¹…ã€‚[åœ¨iOSé¡¹ç›®è¿œç¨‹ä¾èµ–FlutterModuleç»„ä»¶åº“ä»£ç ï¼ˆ5ä¸ªå¯è¡Œæ–¹æ¡ˆï¼‰]ä¸­ï¼Œæ•´ç†äº†5ä¸ªå¯è¡Œçš„è¿œç¨‹æˆ–ä¸­è½¬ä¾èµ–æ–¹æ¡ˆï¼Œæˆ‘ä¸ªäººé€‰æ‹© [è¿œç¨‹ä¾èµ–Flutter Moduleç»„ä»¶åº“ç¼–è¯‘äº§ç‰©  æ–¹æ¡ˆ0x05]æ¥å®ç°è¿œç¨‹ä¾èµ–ï¼Œå³ç»æœ¬åœ°podspecä¸­è½¬è¿œç¨‹zip & gitæ··åˆä¾èµ–ï¼Œpodspecæ–‡ä»¶ç»Ÿä¸€æ”¾åˆ°ç‹¬ç«‹ä»“åº“`flutter_module_sdk_podspec.git`ç®¡ç†ï¼Œå¹¶åŸºäºè¿™ä¸ªæ–¹æ¡ˆå®ç°äº†[è¿œç¨‹ä¾èµ–Flutter Moduleç»„ä»¶åº“æ„å»ºè„šæœ¬`flutter_build_script.sh`]ã€‚

ä½†æ˜¯è¿™ä¸ªæ–¹æ¡ˆåœ¨iOSè¿™ç«¯ï¼Œé™¤äº†å…‹éš†æœ¬èº«iOSé¡¹ç›®çš„Gitå¤–ï¼Œè¿˜éœ€è¦å…‹éš†`flutter_module_sdk_podspec.git`ä»“åº“ï¼Œå¹¶ä¸”è¦æ±‚æ‰€æœ‰äººçš„ç”µè„‘ä¸Šè¿™2ä¸ªæœ¬åœ°gitä»“åº“çš„ç›¸å¯¹è·¯å¾„æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ï¼Œä¸ç„¶å®¹å™¨å‡ºç°Gitå†²çªã€‚è¿™å°±éœ€è¦æ‰€æœ‰äººéƒ½éµå®ˆè¿™ä¸ªçº¦å®š/è§„åˆ™ï¼Œåœ¨æœ¬æœºä¸Šæ‰‹åŠ¨å…‹éš†2ä¸ªä»“åº“ï¼Œåªè¦å¤§å®¶ä¿æŒæœ¬æœºä¸Š2ä¸ªgitä»“åº“çš„ç›¸å¯¹è·¯å¾„ä¸€è‡´ï¼Œå°±æ²¡ä»€ä¹ˆé—®é¢˜ã€‚ä½†æ˜¯åˆ°äº†CIæ„å»ºçš„æœºå™¨ä¸Šï¼Œå°±éœ€è¦ç”¨è„šæœ¬æ¥å®ç°è¿™ä¸ªè§„åˆ™ï¼Œæµç¨‹ä¼šæ˜¾å¾—æœ‰ç‚¹ç¹æ‚ã€‚**æ‰€ä»¥é¢ä¸´ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æ€ä¹ˆæŠŠ`flutter_module_sdk_podspec.git`è·Ÿ`iOS.git`å½¢æˆå¼ºå…³ç³»çš„ç»‘å®šï¼Œè€Œä¸æ˜¯é ä¸ç¨³å®šçš„äººä¸ºçº¦å®šå»ä¿æŒå¼±å…³ç³»çš„å…³è”ã€‚** ç¢°å·§çœ‹åˆ°äº†ä¸€ä¸ªå¤§ä½¬æ•´ç†çš„[ã€ŠGitä¸­submoduleçš„ä½¿ç”¨ã€‹](https://zhuanlan.zhihu.com/p/87053283)ï¼Œè¯¦ç»†ä»‹ç»äº†`git submodule`ï¼Œåˆšå¥½èƒ½è§£å†³å‰é¢çš„é—®é¢˜ï¼Œå°†`flutter_module_sdk_podspec.git` "å†…åµŒ"åˆ°`iOS.git`é‡Œé¢ï¼Œå½¢æˆå¼ºå…³ç³»çš„ç»‘å®šã€‚

æ‰€ä»¥æˆ‘åˆåŸºäº [è¿œç¨‹ä¾èµ–Flutter Moduleç»„ä»¶åº“ç¼–è¯‘äº§ç‰©  æ–¹æ¡ˆ0x05] å¢åŠ äº†`git submodule`ï¼Œä»Flutterç¼–è¯‘åˆ°äº§ç‰©åˆ†å‘çš„æµç¨‹æ²¡æœ‰å˜åŠ¨ï¼ˆå³æ­¥éª¤1-8ï¼‰ï¼Œåªæ˜¯æ”¹äº†iOSä¸€ä¾§çš„æµç¨‹ï¼Œè¯¦ç»†çš„ä»‹ç»å¦‚ä¸‹ã€‚

	æ’ä¸€å¥ï¼šæˆ‘ä»‹ç»çš„ä¾‹å­éƒ½æœ‰æåˆ°2ä¸ªGitï¼Œå³flutter_app_sdk.gitå’Œflutter_plugin_sdk.gitï¼Œå…¶å®å¯ä»¥æ•´åˆæˆä¸€ä¸ªGitå­˜æ”¾xcframeworkã€‚  
	æ‹†ä¸æ‹†éƒ½å¯ä»¥ï¼Œæµç¨‹å’Œæ€è·¯æ˜¯ä¸€æ ·çš„ï¼Œæˆ‘ä¸ªäººå»ºè®®ä¸æ‹†ã€‚

**Flutterç¼–è¯‘ -> äº§ç‰©åˆ†å‘**

* 1.å»ºç«‹Gitä»“åº“`flutter_module_sdk_podspec`ã€`flutter_app_sdk.git`å’Œ`flutter_plugin_sdk.git`å¤‡ç”¨ï¼›
* 2.ç¼–è¯‘å‡º Flutter.podspec ã€App.frameworkã€FlutterPluginRegistrant.xcframeworkå’Œå…¶å®ƒç¬¬ä¸‰æ–¹åº“ æ¯”å¦‚ flutter_boost.xcframeworkï¼›

```C
  flutter build ios-framework --cocoapods --xcframework --no-universal --output=../flutter_build/Frameworks/
```

* 3.å°†`App.framework`ç§»åˆ°`flutter_app_sdk.git`æœ¬åœ°ä»“åº“æ ¹ç›®å½•ï¼›`FlutterPluginRegistrant.xcframeworkå’Œå…¶å®ƒç¬¬ä¸‰æ–¹åº“`ç§»åˆ°`flutter_plugin_sdk.git`æœ¬åœ°ä»“åº“æ ¹ç›®å½•ï¼›
* 4.æ‰“ç›¸åŒçš„ç‰ˆæœ¬æ ‡ç­¾ï¼Œåˆ†åˆ«æäº¤åˆ°è¿œç¨‹ä»“åº“ï¼Œå³`flutter_app_sdk.git`å’Œ`flutter_plugin_sdk.git`
* 5.åœ¨`flutter_module_sdk_podspec`æ ¹ç›®å½•åˆ›å»º`FlutterAppSDK.podspec`å’Œ`FlutterPluginSDK.podspec`æ–‡ä»¶ï¼Œ`s.source`è®¾ç½®æˆ`:git => 'http://gitlab.private.cn/flutter/flutter_..._sdk.git', :tag => '..version'`ï¼›
* 6.å°†`Flutter.podspec`ç§»åˆ°`flutter_module_sdk_podspec`æ ¹ç›®å½•ï¼Œå› ä¸ºæœ‰ç°æˆçš„zipèµ„æºï¼Œå°±ä¸éœ€è¦æˆ‘ä»¬ä¸Šä¼ äº†ï¼Œpodspecæ–‡ä»¶ä¹Ÿä¸ç”¨æ”¹ï¼Œç›´æ¥ç”¨å°±è¡Œï¼›
* 7.æ¸…ç©ºåˆ é™¤`flutter_build`ï¼Œä¸´æ—¶ä¸­è½¬ç«™ï¼Œå®Œäº‹å°±æ²¡ç”¨äº†ï¼›
* 8.åœ¨`flutter_module_sdk_podspec.git`æ‰§è¡Œ`commit & push`ï¼Œä¸ç”¨æ‰“æ ‡ç­¾ï¼›     

> `flutter_module_sdk_podspec.gitä»“åº“ç›®å½•ï¼š`
>> * Flutter.podspec
>> * FlutterAppSDK.podspec
>> * FlutterPluginSDK.podspec

**iOSä¾§å¯¼å…¥ä¾èµ–**

è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨`git submodule` å°†`flutter_module_sdk_podspec.git` "å†…åµŒ"åˆ°`iOS.git`ä¸­ï¼Œè¿™æ ·å°±èƒ½ä¿ä½æ¯å°ç”µè„‘ä¸Šè¿™2ä¸ªgitçš„ç›¸å¯¹è·¯å¾„æ˜¯å§‹ç»ˆä¸€è‡´çš„ï¼Œä¸ç”¨æ‹…å¿ƒäººä¸ºå› ç´ å¯¼è‡´è·¯å¾„ä¸ä¸€è‡´çš„é—®é¢˜ã€‚ä¹‹åæ›´æ–°å­æ¨¡å— ç­‰åŒäº æ›´æ–°ä¾èµ–çš„`flutter_module_sdk_podspec.git`ï¼Œè¿™é‡Œåˆåˆ†3ç§æƒ…å†µï¼Œ1.é¦–æ¬¡æ·»åŠ å­æ¨¡å—ã€2.æ–°åŒäº‹é¦–æ¬¡å…‹éš†ios.gitã€3.æ‹‰å–æ›´æ–°å­æ¨¡å—ã€‚

* 9.1.é¦–æ¬¡å¯¼å…¥`submodule`éœ€è¦åœ¨`iOS.git`æœ¬åœ°è·¯å¾„ä¸‹æ·»åŠ `git submodule`  

```C
  cd $HOME/Desktop/workspace/ios.git
  git submodule add 'http://gitlab.private.cn/flutter_module_sdk_podspec.git'
```

* 9.2.æ–°åŒäº‹é¦–æ¬¡å…‹éš†`iOS.git`ï¼Œå¯èƒ½ä¼šé‡åˆ°2ç§æƒ…å†µã€‚

> ä¸€ï¼šæ™®é€šå¸¸è§„çš„å…‹éš†æŒ‡ä»¤ï¼Œå¯èƒ½æŒ‡å®šåˆ†æ”¯ï¼Œä½†æ²¡æœ‰æ‹‰å–`submodule`å­æ¨¡å—ï¼Œå°±éœ€è¦é¢å¤–æ‰§è¡ŒæŒ‡ä»¤å»é€’å½’æ‹‰å–æ›´æ–°å­æ¨¡å—ã€‚

```C
  git clone -b a_branch http://gitlab.private.cn/ios/ios.git 
  git submodule update --init --recursive
```

> äºŒï¼šå…‹éš†çš„åŒæ—¶æŒ‡å®šé€’å½’æ‹‰å–æ›´æ–°å­æ¨¡å—ï¼Œéœ€è¦åœ¨æŒ‡ä»¤ä¸­åŠ ä¸Š`--recurse-submodules`

```C
  git clone -b a_branch http://gitlab.private.cn/ios/ios.git --recurse-submodules
```

* 9.3.`flutter_module_sdk_podspec.git`å‘å¸ƒæ›´æ–°åï¼Œéœ€è¦åœ¨`ios.git`ä¸­æ›´æ–°æœ¬åœ°å­æ¨¡å—ï¼ŒåŠ ä¸Š`foreach`å¯ä»¥å¸®åŠ©æˆ‘ä»¬éå†æ‰€æœ‰çš„å­æ¨¡å—ã€‚

```C
  git submodule foreach 'git pull origin master'
```

* 9.4.å‰é¢3ç§æƒ…å†µï¼Œå¦‚æœæ›´æ–°äº†å­æ¨¡å—ï¼Œåœ¨`ios.git`éƒ½ä¼šäº§ç”Ÿ`modify`ï¼Œæ‰€ä»¥éƒ½éœ€è¦æäº¤æ›´æ–°åˆ°`ios.git`ã€‚

```C
  git status
  # ä¸‹é¢2æ­¥å¯ä»¥åœ¨SourceTreeä¹‹ç±»çš„å®¢æˆ·ç«¯æ“ä½œï¼Œå¯ä»¥çœ‹åˆ° submoduleçš„
  git add -A && git commit -m "add or modify submodule flutter_module_sdk_podspec.git"
  git push origin --tags && git push origin master 
```

* 10.åœ¨Podfileä¸­æ·»åŠ æœ¬åœ°ä¾èµ–ï¼Œ`pod update or install`ï¼Œå³å¯è¿è¡Œä»£ç ï¼›

```C
  pod 'Flutter', :podspec => './flutter_module_sdk_podspec/Flutter.podspec'
  pod 'FlutterAppSDK', :podspec => './flutter_module_sdk_podspec/FlutterAppSDK.podspec'
  pod 'FlutterPluginSDK', :podspec => './flutter_module_sdk_podspec/FlutterPluginSDK.podspec'
```

------

è‡³æ­¤`iOSè¿œç¨‹Flutterç»„ä»¶åº“`çš„å°è¯•å°±ç»“æŸäº†(2021.07.28)ï¼Œå‰å‰ååèŠ±äº†è¿‘2å‘¨æ—¶é—´ï¼Œä¹Ÿæ‰¾åˆ°äº†ä¸ªäººè§‰å¾—OKçš„æ–¹æ¡ˆã€‚åŠ ä¸Šæ„å»ºè„šæœ¬(ä¼ é€é—¨ğŸšª[è¿œç¨‹ä¾èµ–Flutter Moduleç»„ä»¶åº“æ„å»ºè„šæœ¬`flutter_build_script.sh`])ï¼Œç»“åˆèµ·æ¥ç”¨èƒ½èŠ‚çœå¾ˆå¤šæ—¶é—´ã€‚


--------
[è¿œç¨‹ä¾èµ–Flutter Moduleç»„ä»¶åº“ç¼–è¯‘äº§ç‰©ï¼ˆç®€å•ç‰ˆï¼‰]:https://github.com/XiFengLang/flutter_notes/blob/main/add_flutter_to_ios.md#id-h3-4
[åœ¨iOSé¡¹ç›®è¿œç¨‹ä¾èµ–FlutterModuleç»„ä»¶åº“ä»£ç ï¼ˆ5ä¸ªå¯è¡Œæ–¹æ¡ˆï¼‰]:https://github.com/XiFengLang/flutter_notes/blob/main/depend_flutter_module_remotely.md
[è¿œç¨‹ä¾èµ–Flutter Moduleç»„ä»¶åº“æ„å»ºè„šæœ¬`flutter_build_script.sh`]:https://github.com/XiFengLang/flutter_notes/blob/main/flutter_build_script.md
[è¿œç¨‹ä¾èµ–Flutter Moduleç»„ä»¶åº“ç¼–è¯‘äº§ç‰©  æ–¹æ¡ˆ0x05]:https://github.com/XiFengLang/flutter_notes/blob/main/depend_flutter_module_remotely.md#id-h3-05
